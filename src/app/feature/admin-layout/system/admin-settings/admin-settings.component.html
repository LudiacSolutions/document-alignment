<div class="section-header">
  <div>
    <h1>System Settings</h1>
    <p>Configure system-wide settings and preferences</p>
  </div>
  <div class="settings-actions">
    <button class="btn btn-secondary" (click)="resetToDefaults()">
      Reset Defaults
    </button>
    <button class="btn btn-primary" (click)="saveSettings()">
      ðŸ’¾ Save Changes
    </button>
  </div>
</div>

<div class="settings-grid">
  <!-- General Settings -->
  <div class="settings-card">
    <h3 class="settings-card-title">General Settings</h3>
    <form [formGroup]="generalSettingsForm">
      <div class="form-group">
        <label for="systemName">System Name</label>
        <input type="text" id="systemName" formControlName="systemName" />
      </div>
      <div class="form-group">
        <label for="supportEmail">Support Email</label>
        <input type="email" id="supportEmail" formControlName="supportEmail" />
      </div>
      <div class="form-group">
        <label for="timezone">Default Timezone</label>
        <select id="timezone" formControlName="defaultTimezone">
          @for (tz of timezones(); track $index) {
          <option [value]="tz">{{ tz }}</option>
          }
        </select>
      </div>
    </form>
  </div>

  <!-- Subscription Settings -->
  <div class="settings-card">
    <form [formGroup]="subscriptionForm">
      <h3 class="settings-card-title">Subscription Settings</h3>
      <div class="form-group">
        <label for="proPlanPrice">PRO Plan Price (AUD)</label>
        <input
          type="number"
          id="proPlanPrice"
          formControlName="proPlanPriceAud"
        />
      </div>
      <div class="form-group">
        <label for="tokenTopupPrice">Token Top-up Price (AUD)</label>
        <input
          type="number"
          id="tokenTopupPrice"
          formControlName="tokenTopupPriceAud"
        />
      </div>
      <div class="form-group">
        <label for="tokenTopupAmount">Token Top-up Amount</label>
        <input
          type="text"
          id="tokenTopupAmount"
          formControlName="tokenTopupAmount"
          readonly
        />
      </div>
    </form>
  </div>

  <!-- Feature Limits -->
  <div class="settings-card">
    <form [formGroup]="featureLimitForm" (ngSubmit)="saveFeatureLimits()">
      <h3 class="settings-card-title">Feature Limits</h3>
      <div formArrayName="features">
        @for (feature of features.controls; let i = $index; track $index) {
        <div class="form-group" [formGroupName]="i">
          <label for="freeMaxValues">
            {{ feature.get("planType")?.value | uppercase }}
            -
            {{ feature.get("featureName")?.value }}</label
          >
          <input
            [type]="
              feature.get('featureName')?.value == 'Value Word Count'
                ? 'text'
                : 'number'
            "
            id="freeMaxValues"
            formControlName="limitValue"
          />
        </div>
        }
      </div>
    </form>
  </div>

  <!-- Email Notifications -->
  <div class="settings-card">
    <h3 class="settings-card-title">Email Notifications</h3>
    <form [formGroup]="emailNotificationForm">
      <div class="checkbox-group">
        <label class="checkbox-label">
          <input type="checkbox" formControlName="newUserRegistrations" />
          <span class="checkbox-custom"></span>
          New user registrations
        </label>
        <label class="checkbox-label">
          <input type="checkbox" formControlName="failedPayments" />
          <span class="checkbox-custom"></span>
          Failed payments
        </label>
        <label class="checkbox-label">
          <input type="checkbox" formControlName="highApiUsageAlerts" />
          <span class="checkbox-custom"></span>
          High API usage alerts
        </label>
        <label class="checkbox-label">
          <input type="checkbox" formControlName="tokenTopupPurchases" />
          <span class="checkbox-custom"></span>
          Token top-up purchases
        </label>
        <label class="checkbox-label">
          <input type="checkbox" formControlName="dailySummaryReports" />
          <span class="checkbox-custom"></span>
          Daily summary reports
        </label>
      </div>
    </form>
  </div>

  <!-- Security -->
  <div class="settings-card">
    <h3 class="settings-card-title">Security</h3>
    <form [formGroup]="securitySettingsForm">
      <!-- New form group for security -->
      <div class="form-group">
        <label for="sessionTimeout">Session Timeout (minutes)</label>
        <input
          type="number"
          id="sessionTimeout"
          formControlName="sessionTimeout"
        />
      </div>
      <div class="form-group">
        <label for="maxLoginAttempts">Max Login Attempts</label>
        <input
          type="number"
          id="maxLoginAttempts"
          formControlName="maxLoginAttempts"
        />
      </div>
    </form>
    <button class="btn btn-danger" (click)="forceLogoutAll()">
      Force Logout All Users
    </button>
  </div>
</div>
